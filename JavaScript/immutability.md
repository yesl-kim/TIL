# 불변성

> **불변성이란?**
>
> 객체가 생성된 이후 그 상태를 변경할 수 없는 디자인 패턴을 말한다.

## 왜 불변성이 필요한가

- 객체는 참조형 데이터이기 때문에 (자세한 건 데이터 타입 부분에서) 원본 객체가 변경되면 이를 참조하는 모든 곳에서 변경이 일어난다 -> 의도치 않은 변경이 일어날 수 있다
- 이로 인해 오류가 발생하면 영향 관계를 파악하기 어려워 디버깅이 쉽지 않다
- 또는 객체의 변경 전, 후 혹은 변경 시점을 알아야 하는 경우 (리액트 상태 업데이트시 TODO)

## 불변성을 지키는 방법

1. 객체 복사 후 변경
2. 객체의 불변화

### 객체 복사

```js
const a = { foo: 1 };
const b = a;
a === b; // true

b.foo = 2;
a.foo; // 2
a === b; // true
```

- 객체를 복사하여 새로운 객체를 만들고 새로운 객체에 변경을 가한다.
- 객체는 참조형 데이터이기 때문에 객체를 가리키는 변수(a)를 또 다른 변수(b)에 그대로 할당한다고 해서 새로운 객체로 복사되지 않는다.
- 복사 방법에는 1) 얕은 복사, 2) 깊은 복사 방법이 있다.

#### 얕은 복사

- 내부 프로퍼티를 모두 순회하며 복사하는 방법
- Object.assign (ES6)
- spread 연산자를 사용한 방법 (ES6)

한계점

- 1 depth의 내부 프로퍼티만 복사하는 방법으로 내부 프로퍼티의 데이터 타입이 참조형일 경우 같은 문제가 일어난다. (가변한다)
- 내부 프로퍼티가 참조형 데이터일 경우, 다시 그 내부 프로퍼티의 내부 프로퍼티가 참조형 데이터일 경우, ... 재귀적으로 복사를 해줘야한다 = 깊은 복사

#### 깊은 복사

- ???
- JSON을 이용한 방법
  - 장점: 간단하다
  - 한계점: 메소드나 프로토타입 체이닝에 의한 프로퍼티는 복사되지 않는다.
    -> 메소드가 유실되거나 객체의 내장 메소드를 사용할 수 없다
    -> 네트워크 통신을 통해 전달받은 값처럼 순수한 정보만 담고 있는 객체에만 사용하도록 한다
- 라이브러리 사용: immer.js, immutable.js 등

### 객체의 불변화

- 객체에 변경이 일어나지 않도록 반드시 보장해야한다면 아예 객체를 변하지 않는 객체 (불변 객체)로 만들 수도 있다 (얼음!)

---

NEXT?

- [ ] 객체 복사 방법 - https://dassur.ma/things/deep-copy/
- [ ] observer pattern
- [ ]
